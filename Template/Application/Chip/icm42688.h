#ifndef __ICM42688_H
#define __ICM42688_H


#include "dev_conf.h"
#include "PCA9544.h"
#include "dev_iic.h"
#include "main.h"

/*
	ICM42688 at 1 channel of 9548
*/

#define IMU_INT1_PIN						GPIO_PIN_9
#define IMU_INT1_GPIO_PORT			GPIOA
#define IMU_INT1_GPIO_RCU				RCU_GPIOA

#define IMU_INT2_PIN						GPIO_PIN_10
#define IMU_INT2_GPIO_PORT			GPIOA
#define IMU_INT2_GPIO_RCU				RCU_GPIOA

//
#define ICM42688_IIC_ADDR  (0x68<<1)

#define ICM42688_CHANNEL PCA9544_CHANNEL_1

#define ICM42688_IIC_BUS 1

#define ICM42688_BANK_0 			 0x00

#define ICM42688_DEVICE_CONFIG 0x11
#define ICM42688_DRIVE_CONFIG  0x13
#define ICM42688_INT_CONFIG    0x14
#define ICM42688_FIFO_CONFIG	 0x16

#define ICM42688_TEMP_DATA1 	 0x1D
#define ICM42688_TEMP_DATA0 	 0x1E

#define ICM42688_ACCEL_DATA_X1 0x1F
#define ICM42688_ACCEL_DATA_X0 0x20

#define ICM42688_ACCEL_DATA_Y1 0x21
#define ICM42688_ACCEL_DATA_Y0 0x22

#define ICM42688_ACCEL_DATA_Z1 0x23
#define ICM42688_ACCEL_DATA_Z0 0x24

#define ICM42688_GYRO_DATA_X1  0x25
#define ICM42688_GYRO_DATA_X0  0x26

#define ICM42688_GYRO_DATA_Y1  0x27
#define ICM42688_GYRO_DATA_Y0  0x28

#define ICM42688_GYRO_DATA_Z1  0x29
#define ICM42688_GYRO_DATA_Z0  0x2A

#define ICM42688_TMST_FSYNCH	 0x2B
#define	ICM42688_TMST_FSYNCL   0x2C

#define ICM42688_INT_STATUS 0x2D

#define ICM42688_FIFO_COUNTH  0x2E
#define ICM42688_FIFO_COUNTL  0x2F
#define ICM42688_FIFO_DATA		0x30

#define ICM42688_APEX_DATA0		0x31
#define ICM42688_APEX_DATA1		0x32
#define ICM42688_APEX_DATA2		0x33
#define ICM42688_APEX_DATA3		0x34
#define ICM42688_APEX_DATA4		0x35
#define ICM42688_APEX_DATA5		0x36

#define ICM42688_INT_STATUS2 0x37
#define ICM42688_INT_STATUS3 0x38

#define ICM42688_SIGNAL_PATH_RESET 0x48
#define ICM42688_INTF_CONFIG0 0x4C
#define ICM42688_INTF_CONFIG1 0x4D
#define ICM42688_PWR_MGMT0 0x4E

#define ICM42688_GYRO_CONFIG0 0x4F
#define ICM42688_ACCEL_CONFIG0 0x50
#define ICM42688_GYRO_CONFIG1 0x51
#define ICM42688_GYRO_ACCEL_CONFIG0 0x52
#define ICM42688_ACCEL_CONFIG1 0x53

#define ICM42688_TMST_CONFIG  0x54
#define ICM42688_APEX_CONFIG0  0x56
#define ICM42688_SMD_CONFIG	  0x57
#define ICM42688_FIFO_CONFIG1	 0x5F
#define ICM42688_FIFO_CONFIG2  0x60
#define ICM42688_FIFO_CONFIG3  0x61

#define ICM42688_FSYNC_CONFIG  0x62
#define ICM42688_INT_CONFIG0	 0x63
#define ICM42688_INT_CONFIG1   0x64

#define ICM42688_INT_SOURCE0   0x65
#define ICM42688_INT_SOURCE1	 0x66
#define ICM42688_INT_SOURCE3	 0x68
#define ICM42688_INT_SOURCE4 	 0x69

#define ICM42688_FIFO_LOST_PKT0  0x6C
#define ICM42688_FIFO_LOST_PKT1  0x6D

#define ICM42688_SELF_TEST_CONFIG  0x70
#define	ICM42688_WHO_AM_I	 0x75
#define ICM42688_REG_BANK_SEL	 0x76

#define ICM42688_BANK_1 			 0x01

#define ICM42688_SENSOR_CONFIG0  0x03
#define ICM42688_GYRO_CONFIG_STATIC2	0x0B
#define ICM42688_GYRO_CONFIG_STATIC3	0x0C
#define ICM42688_GYRO_CONFIG_STATIC4	0x0D
#define ICM42688_GYRO_CONFIG_STATIC5	0x0E
#define ICM42688_GYRO_CONFIG_STATIC6	0x0F
#define ICM42688_GYRO_CONFIG_STATIC7	0x10
#define ICM42688_GYRO_CONFIG_STATIC8	0x11
#define ICM42688_GYRO_CONFIG_STATIC9	0x12
#define ICM42688_GYRO_CONFIG_STATIC10	0x13

#define ICM42688_XG_ST_DATA	0x5F
#define ICM42688_YG_ST_DATA	0x60
#define ICM42688_ZG_ST_DATA	0x61

#define ICM42688_TMSTVAL0	0x62
#define ICM42688_TMSTVAL1	0x63
#define ICM42688_TMSTVAL2	0x64

#define ICM42688_INTF_CONFIG4	0x7A
#define ICM42688_INTF_CONFIG5	0x7B
#define ICM42688_INTF_CONFIG6	0x7C

#define ICM42688_BANK_2  			 0x02
#define ICM42688_BANK_3  			 0x03
#define ICM42688_BANK_4  			 0x04
static unsigned char icm42688_init_cmd[128]=
{
	0x00, 	//ICM42688_DEVICE_CONFIG
	0x05,	  //ICM42688_DRIVE_CONFIG
	0x00,		//ICM42688_INT_CONFIG
	0x00, 	//ICM42688_FIFO_CONFIG
	0x80,   //ICM42688_TEMP_DATA1
	0x00,   //ICM42688_TEMP_DATA0
	0x80,		//ICM42688_ACCEL_DATA_X1
	0x00,		//ICM42688_ACCEL_DATA_X0
	0x80,		//ICM42688_ACCEL_DATA_Y1
	0x00,		//ICM42688_ACCEL_DATA_Y0
	0x80,		//ICM42688_ACCEL_DATA_Z1
	0x00,		//ICM42688_ACCEL_DATA_Z0
	0x80,		//ICM42688_GYRO_DATA_X1
	0x00,		//ICM42688_GYRO_DATA_X0
	0x80,		//ICM42688_GYRO_DATA_Y1
	0x00,		//ICM42688_GYRO_DATA_Y0
	0x80,		//ICM42688_GYRO_DATA_Z1
	0x00,		//ICM42688_GYRO_DATA_Z0
	0x00,   //ICM42688_TMST_FSYNCH
	0x00,		//ICM42688_TMST_FSYNCL
	0x10,		//ICM42688_INT_STATUS
	0x00,		//ICM42688_FIFO_COUNTH
	0x00,		//ICM42688_FIFO_COUNTL
	0xFF,		//ICM42688_FIFO_DATA
	0x00,   //ICM42688_APEX_DATA0
	0x00,   //ICM42688_APEX_DATA1
	0x00,   //ICM42688_APEX_DATA2
	0x04,   //ICM42688_APEX_DATA3
	0x00,   //ICM42688_APEX_DATA4
	0x00,   //ICM42688_APEX_DATA5
	0x00,		//ICM42688_INT_STATUS2
	0x00,		//ICM42688_INT_STATUS3
	0x00,		//ICM42688_SIGNAL_PATH_RESET
	0x30,		//ICM42688_INTF_CONFIG0
	0x91,		//ICM42688_INTF_CONFIG1
	0x0F,		//ICM42688_PWR_MGMT0
	0x06,		//ICM42688_GYRO_CONFIG0
	0x06,		//ICM42688_ACCEL_CONFIG0
	0x16,		//ICM42688_GYRO_CONFIG1
	0x11,		//ICM42688_GYRO_ACCEL_CONFIG0
	0x0D,		//ICM42688_ACCEL_CONFIG1
	0x23,		//ICM42688_TMST_CONFIG
	0x82,		//ICM42688_APEX_CONFIG0
	0x00,		//ICM42688_SMD_CONFIG
	0x00,		//ICM42688_FIFO_CONFIG1
	0x00, 	//ICM42688_FIFO_CONFIG2
	0x00,		//ICM42688_FIFO_CONFIG3
	0x10,		//ICM42688_FSYNC_CONFIG
	0x00,		//ICM42688_INT_CONFIG0
	0x10,		//ICM42688_INT_CONFIG1
	0x00,		//ICM42688_INT_SOURCE0
	0x00,		//ICM42688_INT_SOURCE1
	0x00,		//ICM42688_INT_SOURCE3
	0x00,		//ICM42688_INT_SOURCE4
	0x00,		//ICM42688_FIFO_LOST_PKT0
	0x00,		//ICM42688_FIFO_LOST_PKT1
	0x00,		//ICM42688_SELF_TEST_CONFIG
	0x47,		//ICM42688_WHO_AM_I
	0x00		//ICM42688_REG_BANK_SEL
};

void icm42688_init(void);
int icm42688_print(unsigned char reg);
void icm42688_print_test(void);
unsigned char icm42688_get_acc(unsigned char *read_acc);
unsigned char icm42688_get_gyro(unsigned char *read_gyro);
unsigned char icm42688_get_temp(unsigned char *read_temp);


#endif

